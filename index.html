<!doctype html>
<html class="no-js" lang="">

<head>
  <style>
    img {
      width: 100%;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
</head>

<body>
  <div id="container"></div>
  <script src="https://cdn.jsdelivr.net/npm/showdown@^1.9.0/dist/showdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    (async () => {
      const converter = new showdown.Converter();
      converter.setOption('emoji', true);

      const commentsResponse = await fetch('https://api.github.com/gists/ef14e052147f86ecc83e1c83af311d6a/comments');
      const comments = await commentsResponse.json();

      const gists = comments
        .sort(() => 0.5 - Math.random())
        .map((comment) => [comment.user.login, comment.body]);

      const colors = [
        "indigo",
        "indigo darken-1",
        "deep-purple darken-1",
        "deep-purple darken-2",
        "light-blue darken-2",
        "light-blue darken-3",
        "blue-grey darken-2",
        "blue-grey darken-3"
      ];

      const template = (cards) => {
        const columnA = [];
        const columnB = [];
        cards.forEach((partial, index) => {
          (index % 2) ? columnB.push(partial): columnA.push(partial);
        });

        return (`
          <div class="row">
            <div class="col s12">
                <div class="col s6" data-col="1" >
                  ${columnA.join('')}
              </div>
              <div class="col s6" data-col="2" >
                  ${columnB.join('')}
              </div>
            </div>
          </div>
        `)
      };

      const cards = gists.map(([user, gist]) => {
        const palette = colors[Math.floor(Math.random() * colors.length)];
        return `          
          <div class="card ${palette}">
            <div class="card-content white-text">
              <span class="activator card-title">${user}</span>
              <p>${converter.makeHtml(gist)}</p>
            </div>
            <div class="card-reveal">
              <span class="card-title grey-text text-darken-4">${user}<i class="material-icons right">close</i></span>
              <p>${converter.makeHtml(gist)}</p>
            </div>
          </div>          
        `;
      });

      document.getElementById('container').innerHTML += template(cards);
    })();
  </script>
</body>

</html>
